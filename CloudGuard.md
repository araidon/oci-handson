# OCIハンズオン-Cloud Guard編

ディテクタの動作確認とメール通知を確認します。

## 1. 前提

- Cloud Guardが有効化済みであること
- Notificationのトピックが作成済みであること

## 2. ターゲットの作成
監視対象とするコンパートメント設定します。

1. コンソールのナビゲーションメニューから [アイデンティティとセキュリティ]→ [クラウドガード/構成]を選択
2. 右ペインの「新規ターゲットの作成」をクリック
3. 以下の設定で作成。下記以外はデフォルトのまま。

|大項目|中項目|設定値|
|---|---|---|
|ターゲット名||（任意の値）|
|コンパートメント||（自分のコンパートメント）|

4. 次へを選択
5. 検出レシピで以下の3つを3つとも選択

![CleanShot 2024-09-24 at 03 49 45](https://github.com/user-attachments/assets/54372f9b-c8d6-44f9-b412-e216f3f7076d)

4. 次へを選択
5. 作成を選択

6. 作成完了後に遷移した画面で、下にスクロールし、[レスポンダ・レシピ]欄の[レシピの追加]を選択

![CleanShot 2024-09-24 at 03 51 51](https://github.com/user-attachments/assets/34b72c72-aa96-4816-84d8-7da4c7ea8316)

7. レスポンダ・レシピで、以下を選択し、レシピの追加を選択

![CleanShot 2024-09-24 at 03 52 21](https://github.com/user-attachments/assets/55c61014-035d-411b-a464-b95ed3b9b226)


## 3. メール送信用のNotificationを作成

1. コンソールのナビゲーションメニューから [監視および管理]→ [イベント・サービス/ルール]を選択
2. [ルールの作成]を選択
3. 以下の設定で作成。下記以外はデフォルトのまま。

|大項目|中項目|設定値|
|---|---|---|
|表示名||（任意の値）|
|説明||(任意の値)|
|ルール条件|条件|イベント・タイプ|
||サービス名|Cloud Guard|
||イベント・タイプ|Detected - Problem|
|アクション|アクション・タイプ|通知|
||通知コンパートメント|（自分のコンパートメント）|
||トピック|（作成済みのトピック）|

4. ルールの作成をクリック


## 4. 構成ディテクタの動作確認
ここでは、Object StorageがPublicのバケットに公開されていることを確認する

### 4-1. Object Storageのバケットを作成

1. コンソールのナビゲーションメニューから [ストレージ]→ [バケット]を選択
2. 左ペインのコンパートメントをバケットを作成するコンパートメントに変更
3. [バケットの作成]を選択
4. 全てデフォルトのまま作成（バケット名は任意の名前でOK）

### 4-2. バケットをパブリックに公開

1. 作成したバケットの名前欄をクリック
2. 右ペインの[可視性の編集] を選択
3. 可視性をパブリックに変更し、変更の保存を選択

可視性:がパブリックとなって、アラートアイコンが表示されていることを確認
![CleanShot 2024-09-23 at 20 18 08](https://github.com/user-attachments/assets/c0bd2749-4fe8-4a72-9cbd-553d9023b90f)

### 4-3. クラウドガードで検知していることを確認

1. コンソールのナビゲーションメニューから [アイデンティティとセキュリティ]→ [クラウドガード/アラート]を選択
2. "Bucket is public"が表示されていることを確認

※エラーを検知するのに数分ほどかかる可能性があります。適宜ブラウザリロード等をお願いします。

![CleanShot 2024-09-23 at 23 34 44](https://github.com/user-attachments/assets/9250d1db-a79a-4cd7-b3a8-659fe7d65243)

3. 問題名をクリックし、詳細を確認
   エラーメッセージは英語で表記されるため、ブラウザの日本語検索などをご活用ください。

![CleanShot 2024-09-23 at 23 36 55](https://github.com/user-attachments/assets/1a040935-cd13-436d-b2e0-1d4854338400)

### 4-4. メールを受信していることを確認

下記のようなメールを受信していることを確認

![CleanShot 2024-09-24 at 04 35 55](https://github.com/user-attachments/assets/9eff6bf8-8f5b-46a6-b820-9583d848685e)
